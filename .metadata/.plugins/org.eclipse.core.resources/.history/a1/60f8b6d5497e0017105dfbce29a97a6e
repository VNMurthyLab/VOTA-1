'''
Created on Aug 9, 2017

@author: Hao Wu
'''

from ScopeFoundry import HardwareComponent
from .odor_gendev import OdorGenDev
from PyDAQmx import *
import numpy as np
import time

class OdorGenHW(HardwareComponent):
    '''
    Hardware Component Class for receiving AI input for breathing, licking etc
    '''
    
    name='odor_gen'

    def setup(self,num_of_sol=4,buffer_size=1,queue_size=100000):
        '''
        add settings for analog input event
        '''
        self.settings.New(name='num_of_sol',initial=num_of_sol,dtype=int,ro=False)
        self.settings.New(name='buffer_size',initial=buffer_size,dtype=int,ro=True)
        self.settings.New(name='queue_size',initial=buffer_size,dtype=int,ro=False)

        
                
    def connect(self):
        self.dev=OdorGenDev(self.settings.num_of_sol.value(),
                          self.settings.buffer_size.value(),
                          self.settings.queue_size.value())
        self.write=self.dev.write
        self.read=self.dev.read
    
        
    
        
    def disconnect(self):
        try:
            self.dev.close()
            del self.dev
            del self.write
            del self.read
            
        except AttributeError:
            pass
        
if __name__ == '__main__':
    ai=DAQaiHW()
    ai.connect()
    print(ai._data)
    time.sleep(1)
    ai.disconnect()